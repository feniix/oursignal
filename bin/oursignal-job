#!/usr/bin/env ruby
require_relative '../lib/oursignal/cli'
require 'optparse'
require 'oursignal/job'
require 'oursignal/cli'
require 'resque/workers'

daemonize, logfile, help, workers = false, $stdout, false, 1

OptionParser.new do |op|
  op.on('-h', '--h', '--help')  { help = true}
  op.on('-n', '--num-workers n'){|n| workers = n.to_i}
  op.on('--log FILE', String)   {|l| logfile  = l}
end.parse!

# puts(usage) && exit if help

command = (ARGV.shift || 'help').strip
usage   = %Q{
  usage: #{Oursignal::Cli.bin} [-h|--help] [-n workers] [-D] [--log FILE] command

  Commands are:
    start      Fire up job workers.
    stop       Stop job workers.
}.strip

case command
  when 'start' then Resque::Workers.start(workers: workers)
  when 'stop'  then Resque::Workers.stop
  else puts usage
end

